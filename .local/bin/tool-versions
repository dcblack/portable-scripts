#!/usr/bin/env bash
#
#$Info: tool-versions - displays version information for selected development tools. $

EXTRA=0
TOOLS=()
while [[ $# != 0 ]]; do
  case "$1" in
    -h|--help)
      cat <<EOT
NAME
  Display the versions of tools
SYNOPSIS
  tools -h|--help
  tools --version
  tools
  tools [-a|--extra]
  tools TOOL...
EOT
      exit
      ;;
    -a|--extra[s]?) EXTRA=1 ;;
    --version) echo "version 1.0" ; exit ;;
    -*) echo "Error: Uknown option: $1"; exit 1 ;;
    *) TOOLS+=("$1") ;;
  esac
  shift
done

if [[ "${#TOOLS[@]}" == 0 ]]; then
  TOOLS=(
    systemc-version
    g++
    clang++
    cmake
    autoconf
    make
    gmake
    ninja
    gdb
    lldb
    bash
    zsh
  )
fi
EXTRAS=(
  ag 
  clang-format
  clang-tidy
  git
  grep
  rsync
  shellcheck
)

GREP="grep"
# shellcheck disable=SC2312
if [[ -n "$(command -v ggrep )" ]]; then
  GREP="ggrep"
fi
UNAME="uname"
# shellcheck disable=SC2312
if [[ -n "$(command -v guname )" ]]; then
  UNAME="guname"
fi

if [[ ${EXTRA} == 1 ]]; then
  TOOLS=("${TOOLS[@]}" "${EXTRAS[@]}")
fi

echo "----------------------------------------"

# shellcheck disable=SC2034,SC2016
PERLSCRIPT='$car=shift @F;$cdr=qq{@F};'
FILTER='AUTHORS'
FILTER+='|Capabilities'
FILTER+='|Copyright'
FILTER+='|Features'
FILTER+='|internal'
FILTER+='|Install'
FILTER+='|License'
FILTER+='|Licence'
FILTER+='|licenses'
FILTER+='|lzma'
FILTER+='|maintained'
FILTER+='|rsync.samba'
FILTER+='|ShellCheck'
FILTER+='|Swift'
FILTER+='|There'
FILTER+='|This'
FILTER+='|Thread'
FILTER+='|Target'
FILTER+='|website'
FILTER+='|welcome'
FILTER+='|Written'
HOSTOS="$("${UNAME}" -s)"
case "${HOSTOS}" in
  Darwin) 
    "${UNAME}" -moprv
    OS="$(sw_vers --productName) "
    OS+="$(sw_vers --productVersion)"
    OS+="$(sw_vers --productVersionExtra) "
    OS+="$(sw_vers --buildVersion) "
    echo "${OS}"
    ;;
  *) "${UNAME}" -smoprv ;;
esac

echo "........................................"

for TOOL in "${TOOLS[@]}"; do
  EXISTS="$(command -v "${TOOL}")"
  PATT=""
  if [[ -n "${EXISTS}" ]]; then
    case "${TOOL}" in
      g[+][+]|clang|bash|zsh) PATT="${TOOL}" ;;
      make|gmake) PATT="Make" ;;
      clang-tidy|git|rsync|shellcheck) PATT="version" ;;
      *)   PATT+="" ;;
    esac
    echo -n "${TOOL} - "
    # shellcheck disable=SC2312
    "${TOOL}" --version 2>/dev/null \
    | "${GREP}" -E "${PATT}" \
    | "${GREP}" -v -E "(${FILTER})" \
    | "${GREP}" -v '^$' \
    ;
  else
    echo "${TOOL} - MISSING"
  fi
done

echo "----------------------------------------"

# vim:nospell
