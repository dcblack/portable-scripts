#!/usr/bin/env bash
#
# git-alias - List all or specified git aliases

TOOLNAME=git-alias
VERSION=1.0

#-------------------------------------------------------------------------------
function Git_alias_help()
{
  local HELPTEXT
  # shellcheck disable=SC2016
  HELPTEXT=$(cat <<'HELPTEXT'
Name
----

TOOLNAME (vVERSION) - create a directory archive.

Synopsis
--------

```sh
TOOLNAME --help
TOOLNAME list ['GLOB']
TOOLNAME dump ['GLOB']
TOOLNAME show ['GLOB']
TOOLNAME add NAME 'VALUE'
TOOLNAME rm NAME
```

Options
-------

| Option   | Aka | Description                   |
| -------- | --- | ----------------------------- |
| --help   | -h  | Display this text             |

HELPTEXT
)
  HELPTEXT="$(Repl "${HELPTEXT}" "TOOLNAME" "${TOOLNAME}")"
  HELPTEXT="$(Repl "${HELPTEXT}" "VERSION" "${VERSION}")"
  if builtin command -v glow; then
    echo "${HELPTEXT}" | glow -p
  else
    echo "${HELPTEXT}" | less
  fi
}#endfunction Git_alias_help

#-------------------------------------------------------------------------------
function Repl()
{
  local VAR="$1" NAME="$2" REPL="$3"
  while [[ "${VAR}" =~ ${NAME} ]]; do
    VAR="${VAR/${NAME}/${REPL}}"
  done
  echo "${VAR}"
}#endfunction Repl


#-------------------------------------------------------------------------------
function Git_alias()
{
  if [[ $# == 0 ]]; then
    git config --get-regexp 'alias.*' | colrm 1 6 | sed -e 's/ .*//' | fmt | table || true
  else
    local ACTION="list"
    local OUT ALIAS
    while [[ $# -gt 0 ]]; do
      case "$1" in
        --help|-help|-h|help)
          Git_alias_help
          return 0
          ;;
        list|show|add|rm) ACTION="-$1" ;;
        dump)
          if [[ $# == 0 ]]; then
            mapfile -t OUT < <(git config --global --get-regexp "alias." || true)
            for ALIAS in "${OUT[@]}"; do
              printf "%s\n" "${ALIAS}"
            done
          else
            ACTION="-dump"
          fi
          ;;
        *)
          case "${ACTION}" in
            -list)
              git config --global --get-regexp "alias.$1" | perl -pe 's/^alias\.//;s/ .*//' || true
              ;;
            -dump)
              mapfile -t OUT < <(git config --global --get-regexp "alias.$1" || true)
              for ALIAS in "${OUT[@]}"; do
                printf "%s => \n" "${ALIAS}"
              done
              ;;
            -add)
              git config --global --add "alias.$1" "$2" && printf "\033[1;96mAdded %s\033[0m\n" "$1"
              shift
              ;;
            -rm)
              git config --global --unset "alias.$1" && printf "\033[1;96mRemoved %s\033[0m\n" "$1"
              ;;
            -show)
              mapfile -t OUT < <(git config --global --get "alias.$1" || true)
              if [[ -n "${OUT[*]}" ]]; then
                printf "%s => %s\n" "$1" "${OUT[*]}"
              fi
              ;;
            *)
              ;;
          esac
      esac
      shift
    done
  fi
}

Git_alias "$@"

# THE END
