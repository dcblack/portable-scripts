#!/usr/bin/env bash
#
# shellcheck disable=SC2312

#-------------------------------------------------------------------------------
# Make things more visible in the output

function Ruler() {
  /usr/bin/perl -le 'printf qq{\n%80.80s\n},"@ARGV"x80' "$*"
}

# Ensure that error messages are clearly seen
function Die() {
  local CRED CGRN CBLU CNONE
  CRED="[31m" CGRN="[32m" CBLU="[34m" NONE="[00m"

  Ruler '!'
  echo "${CRED}Fatal: $*${NONE}" 1>&2
  exit 1
}

function Report_info() {
  local CRED CGRN CBLU CNONE
  CRED="[31m" CGRN="[32m" CBLU="[34m" NONE="[00m"

  Ruler '-'
  echo "${CGRN}Report_info: ${CBLU}$*${NONE}"
}

#-------------------------------------------------------------------------------
SRC="${HOME}/.local/src"
mkdir -p "${SRC}"
cd "${SRC}" || Die "Unable to enter source directory ${SRC}"
echo "Fetching ninja"
git clone https://github.com/ninja-build/ninja.git || Die "Unable to clone"
cd ninja || Die "Unable to enter repo"
echo "Configuring ninja"
cmake
cmake -Bbuild-cmake -H.
cmake --build build-cmake
build-cmake/ninja_test
rsync -av build-cmake/ninja "${HOME}/.local/bin/"
